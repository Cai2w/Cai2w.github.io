---
title: 谷粒商城
date: 2021-08-12 11:04:32
tags:
- 谷粒商城
- springboot
- springcloud
- 前后端分离
- 分布式
- 微服务
categories:
- 项目实战
description: 比较完善的java开发的大型电商项目。涵盖分布式，微服务，自动化部署等一系列技术
sticky: 1
cover: https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/undraw_circuit_board_4c4d.png
---

## 安装docker

- **安装一台虚拟机(这里就不过多说了)**

- **修改linuxIP相关配置**

**要求：**将ip地址配置成静态的。这里把IP地址配置成192.168.200.11

```
#打开网络相关配置文件
vim /etc/sysconfig/network-scripts/ifcfg-ens33

#修改该配置文件
#IP的配置方法[none|static|bootp|dhcp](引导时不适用协议|静态分配IP|BOOTP协议|DHCP协议)
BOOTPROTO="static"
#IP地址
IPADDR=192.168.200.11
#网关
GATEWAY=192.168.200.2
#域名解析器
DNS1=192.168.200.2

#重启网络服务让配置生效(重启网络或者重启机器都可以)
#重启网络 
service network restart
#重启系统
shutdown -r now
#或者
reboot
```

> 网络配置文件说明
> TYPE="Ethernet"                # 网络类型（通常是Ethernet）
> UUID="48888f85-4f38-4400-adf1-aab4bf2420cb"  #随机id
> DEVICE="ens33"        # 接口名（设备，网卡）
> ONBOOT="yes"        # 系统启动的时候网络接口是否有效（yes/no）

- **卸载旧版本**

较旧的 Docker 版本称为 docker 或 docker-engine 。如果已安装这些程序，请卸载它们以及相关的依赖项。

```bash
$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
```

- **设置仓库**

安装所需的软件包。yum-utils 提供了 yum-config-manager ，并且 device mapper 存储驱动程序需要 device-mapper-persistent-data 和 lvm2。

```bash
$ sudo yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2
```

- **设置源地址，可以使用官方的，也可以使用阿里的镜像源【推荐】**

使用官方源地址（比较慢）

```bash
$ sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
```


阿里云**【推荐】**

```bash
$ sudo yum-config-manager \
    --add-repo \
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
```

- **安装 Docker Engine-Community**

```bash
$ sudo yum install docker-ce docker-ce-cli containerd.io
```

- **启动 Docker**

```bash
$ sudo systemctl start docker
```

- **验证docker是否安装成功**

```bash
$ sudo docker --version
```

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210812105934.png)
安装成功

- **卸载docker**

```bash
#删除安装包
yum remove docker-ce
#删除镜像、容器、配置文件等内容
rm -rf /var/lib/docker
```

- **配置镜像加速器**

配置阿里云的镜像加速器提高下载速度
分步执行（我使用#分割开了）

```bash
#
sudo mkdir -p /etc/docker
#
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://mlyx1bcv.mirror.aliyuncs.com"]
}
EOF
#
sudo systemctl daemon-reload
#
sudo systemctl restart docker
```

- **设置开机自启**

```bash
sudo systemctl enable docker
```

## docker容器安装

登录[https://hub.docker.com/](https://hub.docker.com/) 直接搜索要下载的软件

### mysql5.7

```bash
sudo docker pull mysql:5.7
```

- **查看下载的容器**

```bash
sudo docker images
```

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210812110029.png)
可以看到我们已经下载好的mysql

- **创建实例并启动**

```bash
# --name指定容器名字 -v目录挂载 -p指定端口映射  -e设置mysql参数 -d后台运行
# 端口映射     linux端口:容器端口
sudo docker run -p 3306:3306 --name mysql \
-v /mydata/mysql/log:/var/log/mysql \
-v /mydata/mysql/data:/var/lib/mysql \
-v /mydata/mysql/conf:/etc/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-d mysql:5.7
```

- **查看doker运行中的容器**

```bash
docker ps
```

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210812110128.png)
这时，我们就可以ip:3306连接我们的mysql了

- **进入mysql容器(可以理解就是一个完整的linux)**

```bash
docker exec -it mysql bin/bash
```

- **mysql容器中查看mysql装在了哪**

```bash
whereis mysql
```

- **退出容器**

```bash
exit;
```

- **修改mysql的配置文件，编码改为utf8**

因为有目录映射，所以我们可以直接在镜像外执行

```bash
vim /mydata/mysql/conf/my.conf 


[client]
default-character-set=utf8
[mysql]
default-character-set=utf8
[mysqld]
init_connect='SET collation_connection = utf8_unicode_ci'
init_connect='SET NAMES utf8'
character-set-server=utf8
collation-server=utf8_unicode_ci
skip-character-set-client-handshake
skip-name-resolve

# 重启mysql容器让配置生效
docker restart mysql
```

### redis

```bash
docker pull redis
```

如果直接挂载的话docker会以为挂载的是一个目录，所以我们先创建一个文件然后再挂载，在虚拟机中。

- **启动redis**

```bash
# 在虚拟机中
mkdir -p /mydata/redis/conf
touch /mydata/redis/conf/redis.conf

# 启动
docker run -p 6379:6379 --name redis \
-v /mydata/redis/data:/data \
-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \
-d redis redis-server /etc/redis/redis.conf
```

- **连接redis客户端**

```bash
# 直接进去redis客户端。
docker exec -it redis redis-cli
```

这样默认是没有持久化的。我们需要在配置容器中appendonly yes，就可以aof持久化了。**修改完记得重启服务**

- **开启redis的aof持久化**

```bash
vim /mydata/redis/conf/redis.conf
# 插入内容
appendonly yes
#保存

# 重启服务
docker restart redis
```

> **注意：最新版的redis默认是aof持久化的，即使不执行上述修改，也是默认aof持久化的**

## 开发环境

### 开发工具

- **前端：VSCode**
  - 插件：
    - **Auto Close Tag**
    - **Auto Rename Tag**
    - **Chinese**
    - **ESlint**
    - **HTML CSS Support**
    - **HTML Snippets**
    - **JavaScript ES6**
    - **Live Server**
    - **open in brower**
    - **Vetur**
- **后端：Idea**
  - 插件：
    - **lombok**
    - **mybatisX**
  - maven：配置阿里云镜像

```xml
<mirror>
	<id>alimaven</id>
	<mirrorOf>central</mirrorOf>
	<name>aliyun maven</name>
	<url>http://maven.aliyun.com/nexus/content/repositories/central/</url>
</mirror>
```

### 环境版本

- Java：1.8

- Maven：我用的3.5.2

## 代码版本控制

### Git

- 下载git：一路next就行
- 右键 --> Git Bash

```bash
# 配置用户名
git config --global user.name "caicai"  //(名字，随意写)

# 配置邮箱
git config --global user.email "1732804469@qq.com" // 注册账号时使用的邮箱

# 配置ssh免密登录
ssh-keygen -t rsa -C "1732804469@qq.com"
三次回车后生成了密钥：公钥私钥
cat ~/.ssh/id_rsa.pub

也可以查看密钥

浏览器登录码云后，个人头像上点设置--ssh公钥---随便填个标题---复制
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC83LbqGf+eA0YAMfbLPxQRsxaroaV6rWBGWsdcNxXBdTEV3eS6JaYdjRLdht38zIjXq8+jfuMA9Wgiy90eIWi9IEz0abEyHntlldzlW7L9szRGJbPgGfgVU5y0pCZYJ/5+fRU90ZVFrCNPmubK8tBHo45CPaEEDLhETBWUA6wG5Lp1knpf33kYpI95P0FIV6a2c2rnLcFTY3Q3LkXhNSxa3dU9Fj0zaPGPABUV44HTFtlCCeEaREgh0UYizxCGW+ixSN+UXZmpqlutRrzDm1kSIrUcpeh+k8vWpAvF/JcbPATC8gguhhZhOVYRLamzJqVsmGklkskZPmQLDNvB/hIfzD4eu5dQN+F2KQt6hWzfZ1L6hiX/oKOWMpkYjnZJSHEFFYBFslDTKWvCdVmX5RDpr680fqbj3v1P8FF/l2H6ZoBtBFU4N2//az/9+kZNzoqEzbaHfkMkZWTzycdz1ME2MEhnB3QdDan1rHYWYLQaY4AL3pHlEPExpt2K9RprDGE= 1732804469@qq.com

# 测试
ssh -T git@gitee.com
测试成功，就可以无密给码云推送仓库了
```

## 项目搭建

经上述的操作，我们已经把ssh配置好了，接下来，我们创建仓库。

- 在码云新建仓库，仓库名gulimall，选择语言java，在.gitignore选中maven（就会忽略掉maven一些个人无需上传的配置文件），许可证选Apache-2.0，开发模型选生成/开发模型，开发时在dev分支，发布时在master分支，创建。
- 在IDEA中New–Project from version control–git–复制刚才项目的地址，如`https://gitee.com/Cai2w/gilimall.git`
- IDEA然后New Module –> Spring Initializer –> wang.cai2.gulimall ， Artifact填 gulimall-product。Next—选择`web`（web开发），springcloud routing里选中`openFeign`（rpc调用）。
- 依次创建出以下服务
  - 商品服务product
  - 存储服务ware
  - 订单服务order
  - 优惠券服务coupon
  - 用户服务member
- 共同点：

  - 导入web和openFeign
  - group：com.atguigu.gulimall
  - Artifact：gulimall-XXX
  - 每一个服务，包名com.atguigu.gulimall.XXX{product/order/ware/coupon/member}
  - 模块名：gulimall-XXX

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/image-20210812110228997.png)

> 配置好之后,点击右下角的显示的springboot的service选项

- 随便从一个项目复制一个pom文件粘贴到gulimall总项目目录,修改成下方这样

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>wang.cai2.gulimall</groupId>
    <artifactId>gulimall</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>gulimall</name>
    <description>聚合服务</description>
    <packaging>pom</packaging>
    <modules>
        <module>gulimall-coupon</module>
        <module>gulimall-member</module>
        <module>gulimall-order</module>
        <module>gulimall-product</module>
        <module>gulimall-ware</module>
    </modules>
</project>

```

- 点击项目右侧的maven，然后点击加号，将该pom文件添加的项目中

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210817004233.png)

添加进来之后，就会发现多了一个root。这样比如运行root的clean命令，其他项目也一起clean了。

- 在总项目的`.gitignore`文件中添加如下配置，把我们项目中不需要提交的文件忽略掉。

```
**/mvnw
**/mvnw.cmd
**/.mvn
**/target/
.idea
**/.gitignore
```

在idea左侧的commit一栏中，点击刷新按钮，观察Unversioned Files中文件数量的变化。全选最后剩下21个文件，选择右键、Add to VCS（添加到版本控制）。

- 将初版项目提交到gitee。
  - 在idea的插件中心下载gitee，重启idea
  - 项目commit，push（也可以点击图中commit右边的 `commit and push`）

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210817005554.png)
![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210817010538.png)