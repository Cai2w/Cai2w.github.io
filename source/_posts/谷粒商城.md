---
title: 谷粒商城
date: 2021-08-12 11:04:32
tags:
- 谷粒商城
- springboot
- springcloud
- 前后端分离
- 分布式
- 微服务
categories:
- 项目实战
description: 比较完善的java开发的大型电商项目。涵盖分布式，微服务，自动化部署等一系列技术
sticky: 1
cover: https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/undraw_circuit_board_4c4d.png
---

## 安装docker

- **安装一台虚拟机(这里就不过多说了)**

- **修改linuxIP相关配置**

**要求：**将ip地址配置成静态的。这里把IP地址配置成192.168.200.11

```
#打开网络相关配置文件
vim /etc/sysconfig/network-scripts/ifcfg-ens33

#修改该配置文件
#IP的配置方法[none|static|bootp|dhcp](引导时不适用协议|静态分配IP|BOOTP协议|DHCP协议)
BOOTPROTO="static"
#IP地址
IPADDR=192.168.200.11
#网关
GATEWAY=192.168.200.2
#域名解析器
DNS1=192.168.200.2

#重启网络服务让配置生效(重启网络或者重启机器都可以)
#重启网络 
service network restart
#重启系统
shutdown -r now
#或者
reboot
```

> 网络配置文件说明
> TYPE="Ethernet"                # 网络类型（通常是Ethernet）
> UUID="48888f85-4f38-4400-adf1-aab4bf2420cb"  #随机id
> DEVICE="ens33"        # 接口名（设备，网卡）
> ONBOOT="yes"        # 系统启动的时候网络接口是否有效（yes/no）

- **卸载旧版本**

较旧的 Docker 版本称为 docker 或 docker-engine 。如果已安装这些程序，请卸载它们以及相关的依赖项。

```bash
$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
```

- **设置仓库**

安装所需的软件包。yum-utils 提供了 yum-config-manager ，并且 device mapper 存储驱动程序需要 device-mapper-persistent-data 和 lvm2。

```bash
$ sudo yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2
```

- **设置源地址，可以使用官方的，也可以使用阿里的镜像源【推荐】**

使用官方源地址（比较慢）

```bash
$ sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
```


阿里云**【推荐】**

```bash
$ sudo yum-config-manager \
    --add-repo \
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
```

- **安装 Docker Engine-Community**

```bash
$ sudo yum install docker-ce docker-ce-cli containerd.io
```

- **启动 Docker**

```bash
$ sudo systemctl start docker
```

- **验证docker是否安装成功**

```bash
$ sudo docker --version
```

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210812105934.png)
安装成功

- **卸载docker**

```bash
#删除安装包
yum remove docker-ce
#删除镜像、容器、配置文件等内容
rm -rf /var/lib/docker
```

- **配置镜像加速器**

配置阿里云的镜像加速器提高下载速度
分步执行（我使用#分割开了）

```bash
#
sudo mkdir -p /etc/docker
#
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://mlyx1bcv.mirror.aliyuncs.com"]
}
EOF
#
sudo systemctl daemon-reload
#
sudo systemctl restart docker
```

- **设置开机自启**

```bash
sudo systemctl enable docker
```

## docker容器安装

登录[https://hub.docker.com/](https://hub.docker.com/) 直接搜索要下载的软件

### mysql5.7

```bash
sudo docker pull mysql:5.7
```

- **查看下载的容器**

```bash
sudo docker images
```

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210812110029.png)
可以看到我们已经下载好的mysql

- **创建实例并启动**

```bash
# --name指定容器名字 -v目录挂载 -p指定端口映射  -e设置mysql参数 -d后台运行
# 端口映射     linux端口:容器端口
sudo docker run -p 3306:3306 --name mysql \
-v /mydata/mysql/log:/var/log/mysql \
-v /mydata/mysql/data:/var/lib/mysql \
-v /mydata/mysql/conf:/etc/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-d mysql:5.7
```

- **查看doker运行中的容器**

```bash
docker ps
```

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210812110128.png)
这时，我们就可以ip:3306连接我们的mysql了

- **进入mysql容器(可以理解就是一个完整的linux)**

```bash
docker exec -it mysql bin/bash
```

- **mysql容器中查看mysql装在了哪**

```bash
whereis mysql
```

- **退出容器**

```bash
exit;
```

- **修改mysql的配置文件，编码改为utf8**

因为有目录映射，所以我们可以直接在镜像外执行

```bash
vim /mydata/mysql/conf/my.conf 


[client]
default-character-set=utf8
[mysql]
default-character-set=utf8
[mysqld]
init_connect='SET collation_connection = utf8_unicode_ci'
init_connect='SET NAMES utf8'
character-set-server=utf8
collation-server=utf8_unicode_ci
skip-character-set-client-handshake
skip-name-resolve

# 重启mysql容器让配置生效
docker restart mysql
```

### redis

```bash
docker pull redis
```

如果直接挂载的话docker会以为挂载的是一个目录，所以我们先创建一个文件然后再挂载，在虚拟机中。

- **启动redis**

```bash
# 在虚拟机中
mkdir -p /mydata/redis/conf
touch /mydata/redis/conf/redis.conf

# 启动
docker run -p 6379:6379 --name redis \
-v /mydata/redis/data:/data \
-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \
-d redis redis-server /etc/redis/redis.conf
```

- **连接redis客户端**

```bash
# 直接进去redis客户端。
docker exec -it redis redis-cli
```

这样默认是没有持久化的。我们需要在配置容器中appendonly yes，就可以aof持久化了。**修改完记得重启服务**

- **开启redis的aof持久化**

```bash
vim /mydata/redis/conf/redis.conf
# 插入内容
appendonly yes
#保存

# 重启服务
docker restart redis
```

> **注意：最新版的redis默认是aof持久化的，即使不执行上述修改，也是默认aof持久化的**

## 开发环境

### 开发工具

- **前端：VSCode**
  - 插件：
    - **Auto Close Tag**
    - **Auto Rename Tag**
    - **Chinese**
    - **ESlint**
    - **HTML CSS Support**
    - **HTML Snippets**
    - **JavaScript ES6**
    - **Live Server**
    - **open in brower**
    - **Vetur**
- **后端：Idea**
  - 插件：
    - **lombok**
    - **mybatisX**
  - maven：配置阿里云镜像

```xml
<mirror>
	<id>alimaven</id>
	<mirrorOf>central</mirrorOf>
	<name>aliyun maven</name>
	<url>http://maven.aliyun.com/nexus/content/repositories/central/</url>
</mirror>
```

### 环境版本

- Java：1.8

- Maven：我用的3.5.2

## 代码版本控制

### Git

- 下载git：一路next就行
- 右键 --> Git Bash

```bash
# 配置用户名
git config --global user.name "caicai"  //(名字，随意写)

# 配置邮箱
git config --global user.email "1732804469@qq.com" // 注册账号时使用的邮箱

# 配置ssh免密登录
ssh-keygen -t rsa -C "1732804469@qq.com"
三次回车后生成了密钥：公钥私钥
cat ~/.ssh/id_rsa.pub

也可以查看密钥

浏览器登录码云后，个人头像上点设置--ssh公钥---随便填个标题---复制
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC83LbqGf+eA0YAMfbLPxQRsxaroaV6rWBGWsdcNxXBdTEV3eS6JaYdjRLdht38zIjXq8+jfuMA9Wgiy90eIWi9IEz0abEyHntlldzlW7L9szRGJbPgGfgVU5y0pCZYJ/5+fRU90ZVFrCNPmubK8tBHo45CPaEEDLhETBWUA6wG5Lp1knpf33kYpI95P0FIV6a2c2rnLcFTY3Q3LkXhNSxa3dU9Fj0zaPGPABUV44HTFtlCCeEaREgh0UYizxCGW+ixSN+UXZmpqlutRrzDm1kSIrUcpeh+k8vWpAvF/JcbPATC8gguhhZhOVYRLamzJqVsmGklkskZPmQLDNvB/hIfzD4eu5dQN+F2KQt6hWzfZ1L6hiX/oKOWMpkYjnZJSHEFFYBFslDTKWvCdVmX5RDpr680fqbj3v1P8FF/l2H6ZoBtBFU4N2//az/9+kZNzoqEzbaHfkMkZWTzycdz1ME2MEhnB3QdDan1rHYWYLQaY4AL3pHlEPExpt2K9RprDGE= 1732804469@qq.com

# 测试
ssh -T git@gitee.com
测试成功，就可以无密给码云推送仓库了
```

## 项目搭建

经上述的操作，我们已经把ssh配置好了，接下来，我们创建仓库。

- 在码云新建仓库，仓库名gulimall，选择语言java，在.gitignore选中maven（就会忽略掉maven一些个人无需上传的配置文件），许可证选Apache-2.0，开发模型选生成/开发模型，开发时在dev分支，发布时在master分支，创建。
- 在IDEA中New–Project from version control–git–复制刚才项目的地址，如`https://gitee.com/Cai2w/gilimall.git`
- IDEA然后New Module –> Spring Initializer –> wang.cai2.gulimall ， Artifact填 gulimall-product。Next—选择`web`（web开发），springcloud routing里选中`openFeign`（rpc调用）。
- 依次创建出以下服务
  - 商品服务product
  - 存储服务ware
  - 订单服务order
  - 优惠券服务coupon
  - 用户服务member
- 共同点：

  - 导入web和openFeign
  - group：com.atguigu.gulimall
  - Artifact：gulimall-XXX
  - 每一个服务，包名com.atguigu.gulimall.XXX{product/order/ware/coupon/member}
  - 模块名：gulimall-XXX

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/image-20210812110228997.png)

> 配置好之后,点击右下角的显示的springboot的service选项

- 随便从一个项目复制一个pom文件粘贴到gulimall总项目目录,修改成下方这样

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>wang.cai2.gulimall</groupId>
    <artifactId>gulimall</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>gulimall</name>
    <description>聚合服务</description>
    <packaging>pom</packaging>
    <modules>
        <module>gulimall-coupon</module>
        <module>gulimall-member</module>
        <module>gulimall-order</module>
        <module>gulimall-product</module>
        <module>gulimall-ware</module>
    </modules>
</project>

```

- 点击项目右侧的maven，然后点击加号，将该pom文件添加的项目中

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210817004233.png)

添加进来之后，就会发现多了一个root。这样比如运行root的clean命令，其他项目也一起clean了。

- 在总项目的`.gitignore`文件中添加如下配置，把我们项目中不需要提交的文件忽略掉。

```
**/mvnw
**/mvnw.cmd
**/.mvn
**/target/
.idea
**/.gitignore
```

在idea左侧的commit一栏中，点击刷新按钮，观察Unversioned Files中文件数量的变化。全选最后剩下21个文件，选择右键、Add to VCS（添加到版本控制）。

- 将初版项目提交到gitee。
  - 在idea的插件中心下载gitee，重启idea
  - 项目commit，push（也可以点击图中commit右边的 `commit and push`）

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210817005554.png)
![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210817010538.png)

## 数据库配置

### 启动docker的mysql

> 注意重启虚拟机和docker后里面的容器就关了。

```bash
sudo docker ps
sudo docker ps -a
# 这两个命令的差别就是后者会显示  【已创建但没有启动的容器】

# 我们接下来设置我们要用的容器每次都是自动启动
sudo docker update redis --restart=always
sudo docker update mysql --restart=always
# 如果不配置上面的内容的话，我们也可以选择手动启动
sudo docker start mysql
sudo docker start redis
# 如果要进入已启动的容器
sudo docker exec -it mysql /bin/bash
# /bin/bash就是进入一般的命令行，如果改成redis就是进入了redis
```

### 建立数据库

- 连接docker的mysql

建立对应的数据库：

- gulimall_oms
- gulimall_pms
- gulimall_sms
- gulimall_ums
- gulimall_wms

> 数据库名如上，注意：**字符集编码选用`utf8mb4`**，他能兼容utf8且能解决一些乱码的问题

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210817231656.png)

导入对应的sql语句

## 人人项目搭建

### clone项目

- 在码云上搜索**人人开源**
- 将`renren-fast`（后端项目） 和 `renren-fast-vue`（前端项目）clone下来

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818142041.png)

- 贴心的博主把clone命令贴下面了：
  - `renren-fast`：`git clone git@gitee.com:renrenio/renren-fast.git`
  - `renren-fast-vue`：`git clone git@gitee.com:renrenio/renren-fast-vue.git`

- 将clone下来的项目的`.git`文件删除

> **注意：`.git`文件是隐藏文件**

### 后端搭建

#### 集成到谷粒商城

- 将`renren-fast`移动到我们的`gulimall`所在的目录

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818142831.png)

- 在idea中将`renren-fast`设置成maven项目

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818143027.png)

- 将`renren-fast`模块添加到我们的`gulimall`的`pom`中

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818143224.png)

- 刷新maven，让idea导入`renren-fast`需要的文件

> 博主觉得，配置环境要比写代码难。各种环境，真的让人头大。

刷新maven后，如果`renren-fast`的`pom`文件没有出现任何问题，那么恭喜你，你可以跳过下面这一段的错误排查了。

> 博主在pom文件导入资源的过程中，插件爆红，`project`标签也是红的

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818144034.png)

图上的解释也说了

`renren-fast`的parent里写的并不是`renren-fast`的上一级，而是继承了springboot：

```xml
<parent>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-parent</artifactId>
	<version>2.2.4.RELEASE</version>
</parent>
```

加上

```xml
<relativePath />
```

修改为：

```xml
<parent>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-parent</artifactId>
	<version>2.2.4.RELEASE</version>
	<relativePath />
</parent>
```

再次刷新maven即可。

> 小细节：如果`spring-boot-maven-plugin`，我们可以给他加一个版本，让其能正确的导入进来。导入成功后，我们再把版本去掉也不会报错了（去不去都可以）

```xml
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-maven-plugin</artifactId>
<!-- 加上版本 -->
<version>2.5.3</version>
```

#### 添加renren-fast的数据库

打开`renren-fast/db/mysql.sql`，将sql语句复制

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818145537.png)

连接我们的mysql，创建名为`gulimall_admin`的数据库，字符集选择`utf8mb4`

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818145300.png)

执行完成后，我们就得到了`renren-fast`所需的表

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818145343.png)

#### 修改配置文件

修改该项目的`application-dev.yml`数据源配置为我们刚刚配置的数据库

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818145744.png)

在`application.yml`我们可以看到，项目的端口为`8080`，路径为`/renren-fast`

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818145917.png)

启动项目，访问相应的url：`localhost:8080/renren-fast`

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818150200.png)

有数据返回即为项目搭建成功。

> 喝杯java歇息一下吧，接下来是前端项目搭建。

### 前端搭建

#### 准备工作

- 下载node：http://nodejs.cn/download/current/

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818152932.png)

下载LTS版本（稳定版）

- 安装node，一路next就行

`NPM`是随同`NodeJS`一起安装的包管理工具。JavaScript-NPM类似于java-Maven。

打开命令行：

```bash
#查看node版本
node -v 
#配置npm的镜像仓库地址--》淘宝
npm config set registry http://registry.npm.taobao.org/
```

- 下载并安装python，并配置全局变量。（一路next就行，就不贴图了）

#### 项目的相关设置

- 使用`vscode`打开`renren-fast-vue`

- 下载`node-sass`，版本需要和我们下载的node的版本对应

对应关系如下：

| NodeJS  | Supported node-sass version | Node Module |
| ------- | --------------------------- | ----------- |
| Node 16 | 6.0+                        | 93          |
| Node 15 | 5.0+                        | 88          |
| Node 14 | 4.14+                       | 83          |
| Node 13 | 4.13+, <5.0                 | 79          |
| Node 12 | 4.12+                       | 72          |
| Node 11 | 4.10+, <5.0                 | 67          |
| Node 10 | 4.9+, <6.0                  | 64          |
| Node 8  | 4.5.3+, <5.0                | 57          |
| Node <8 | <5.0                        | <57         |

这是在官网看的，你也可以访问官网查询：https://github.com/sass/node-sass

我使用的是node14，所以将node-sass版本设置为4.14

在项目终端下执行：

```bash
# 指定node-sass版本，这句等价于修改package.json文件了。
# 安装node-sass，一定要和node的版本对应
npm install node-sass@4.14
# 安装chromedriver（按理来说不用装这个的，我没装这个，在执行npm install 的时候报错了，所以就写上了）
npm install chromedriver --chromedriver_cdnurl=http://cdn.npm.taobao.org/dist/chromedriver
#安装其他依赖：
npm install

#如果觉得上面的步骤太麻烦，还可以使用下面这个命令：并且它自动更新package的包版本（最新的和你node兼容）
npm install --save node-sass

# 启动项目：
npm run dev
```

然后直接就可以执行起来了。如果没验证码什么的，是因为java项目没有启动

- 卸载残留问题

如果之前执行`npm install`失败了，执行上面代码时要先清依赖残留，否则安装不上

```bash
npm rebuild node-sass
npm uninstall node-sass
```

上面步骤等价于直接删除node_modules，只不过node_modules是删了全部下载的依赖包

> 启动没有问题后，浏览器输入`localhost:8081`就可以看到前端页面了
>
> 初始的账号和密码都是`admin`

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210818160856.png)

## 逆向工程生成CRUD

### 搭建product工程

逆向工程搭建

```bash
git clone https://gitee.com/renrenio/renren-generator.git
```

下载到桌面后，同样把里面的.git文件删除，然后移动到我们IDEA项目目录中，同样配置好pom.xml

```xml
<modules>
    <module>gulimall-coupon</module>
    <module>gulimall-member</module>
    <module>gulimall-order</module>
    <module>gulimall-product</module>
    <module>gulimall-ware</module>
    <module>renren-fast</module>
    <module>renren-generator</module>
</modules>


<!-- 进入自己的pom文件，在parent标签中添加<relativePath/>标签 -->
<parent>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-parent</artifactId>
	<version>2.2.6.RELEASE</version>
	<relativePath/>
</parent>
```

在maven中刷新一下，让项目名变粗体，稍等下面进度条完成。

修改application.yml

```yaml
url: jdbc:mysql://192.168.200.11:3306/gulimall_pms?useUnicode=true&characterEncoding=UTF-8&useSSL=false&serverTimezone=Asia/Shanghai
username: root
password: root
```

然后修改generator.properties

```properties
#代码生成器，配置信息
#主目录
mainPath=wang.cai2
#包名
package=wang.cai2.gulimall
moduleName=product
#作者
author=caicai
#Email
email=cryc8924@gmail.com
#表前缀(类名不会包含表前缀)
tablePrefix=pms_
```

运行`RenrenApplication`。访问http://localhost:80

在网页上下方点击每页显示50个（pms库中的表），以让全部都显示，然后点击全部，点击生成代码。下载了压缩包

解压压缩包，把main放到gulimall-product的同级目录下。

> 我们需要一个common模块用来放置我们公共的代码文件

在项目上右击new modules—> maven，然后在name上输入`gulimall-common`

在pom.xml中也自动添加了`<module>gulimall-common</module>`

在common项目的pom.xml中添加

```xml
<!-- mybatisPLUS-->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.3.2</version>
</dependency>
<!--简化实体类，用@Data代替getset方法-->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.18.8</version>
</dependency>
<!-- httpcomponent包。发送http请求 -->
<dependency>
    <groupId>org.apache.httpcomponents</groupId>
    <artifactId>httpcore</artifactId>
    <version>4.4.13</version>
</dependency>
<dependency>
    <groupId>commons-lang</groupId>
    <artifactId>commons-lang</artifactId>
    <version>2.6</version>
</dependency>
```

我们把每个微服务里公共的类和依赖放到common里

> tips: shift+F6修改项目名
>
> 此外，说下maven依赖的问题。
>
> - `<dependency>`代表本项目依赖，子项目也依赖
> - 如果有个`<optional>`标签，代表本项目依赖，但是子项目不依赖

然后在product项目中的pom.xml中加入下面内容，作为common的子项目

```xml
<dependency>
    <groupId>wang.cai2.gulimall</groupId>
    <artifactId>gulimall-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

复制`renren-fast`的`common.utils`包下的`Query`、`PageUtils`、`R`、`Constant`到到common项目的`java/wang.cai2.common.utils`下；将`renren-fast`的`common.exception`包下的`RRException`也复制到我们common项目下的`java/wang.cai2.common.utils`中；将`renren-fast`的`common.xss`目录复制到我们common项目下的`java/wang.cai2.common`包下面，并把xss包下面的`XssFilter`、`XssHttpServletRequestWrapper`删除。最后，common项目的结构目录如下图

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210819111410.png)

进入`renren-generator`，注释`src/main/resources/template/Controller.java.vm`中所有的`@RequiresPermissions`删除该注解的引用`import org.apache.shiro.authz.annotation.RequiresPermissions;`，他是shiro的东西

总之什么报错就去fast里面找。重启逆向工程。重新在页面上得到压缩包。重新解压出来，不过只把里面的controller复制粘贴到product项目对应的目录就行。

在common的pom.xml中导入

```xml
<!-- 数据库驱动 https://mvnrepository.com/artifact/mysql/mysql-connector-java -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.17</version>
</dependency>
<!--tomcat里一般都带-->
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>servlet-api</artifactId>
    <version>2.5</version>
    <scope>provided</scope>
</dependency>
```

这里附上common项目pom.xml的完整配置：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>gulimall</artifactId>
        <groupId>wang.cai2.gulimall</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>gulimall-common</artifactId>
    <description>每一个微服务公共的依赖</description>

    <properties>
        <maven.compiler.source>8</maven.compiler.source>
        <maven.compiler.target>8</maven.compiler.target>
    </properties>

    <dependencies>
        <!-- mybatisPLUS-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <version>3.3.2</version>
        </dependency>
        <!--简化实体类，用@Data代替getset方法-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.20</version>
        </dependency>
        <!-- httpcomponent包。发送http请求 -->
        <dependency>
            <groupId>org.apache.httpcomponents</groupId>
            <artifactId>httpcore</artifactId>
            <version>4.4.13</version>
        </dependency>
        <dependency>
            <groupId>commons-lang</groupId>
            <artifactId>commons-lang</artifactId>
            <version>2.6</version>
        </dependency>
        <!-- 数据库驱动 https://mvnrepository.com/artifact/mysql/mysql-connector-java -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.17</version>
        </dependency>
        <!--tomcat里一般都带-->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>servlet-api</artifactId>
            <version>2.5</version>
            <scope>provided</scope>
        </dependency>
    </dependencies>

</project>
```

逆向工程使用的是mybatisplus，这里贴上mybatis-plus的地址，不熟悉的小伙伴可以看一下[快速开始](https://mp.baomidou.com/guide/quick-start.html)

在product项目的resources目录下新建application.yml

```yaml
spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql://192.168.200.11:3306/gulimall_pms?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  global-config:
    db-config:
      id-type: auto
```

> classpath 和 classpath\* 区别：
> classpath：只会到你的class路径中查找找文件;
> classpath\*：不仅包含class路径，还包括jar文件中(class路径)进行查找
>
> classpath\*的使用：当项目中有多个classpath路径，并同时加载多个classpath路径下（此种情况多数不会遇到）的文件，\*就发挥了作用，如果不加\*，则表示仅仅加载第一个classpath路径。

然后在主启动类上加上注解@MapperScan()

```java
@MapperScan("wang.cai2.gulimall.product.dao")
@SpringBootApplication
public class GulimallProductApplication {

    public static void main(String[] args) {
        SpringApplication.run(GulimallProductApplication.class, args);
    }

}
```

测试一下：

给数据库添加内容

```java
@SpringBootTest
class GulimallProductApplicationTests {

    @Autowired
    BrandService brandService;
    @Test
    void contextLoads() {
        BrandEntity brandEntity = new BrandEntity();
        brandEntity.setName("华为");
        brandService.save(brandEntity);
        System.out.println("保存成功....");
    }

}
```

查询：

```java
@SpringBootTest
class GulimallProductApplicationTests {

    @Autowired
    BrandService brandService;
    @Test
    void contextLoads() {
        for (BrandEntity brandEntity : brandService.list(new QueryWrapper<BrandEntity>().eq("brand_id", 1))) {
            System.out.println(brandEntity);
        }

    }

}
```

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210819113351.png)

测试成功

### 搭建其他项目

#### coupon

优惠券服务。

让coupon也依赖于common，修改pom.xml

```xml
<dependency>
    <groupId>wang.cai2.gulimall</groupId>
    <artifactId>gulimall-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

重新打开generator逆向工程，修改`generator.properties`

```properties
#代码生成器，配置信息
#主目录
mainPath=wang.cai2
#包名
package=wang.cai2.gulimall
moduleName=coupon
#作者
author=caicai
#Email
email=1732804469@qq.com
#表前缀(类名不会包含表前缀)
tablePrefix=sms_
```

> `application.yml`设置好要连接的数据源，启动逆向工程生成代码。将main粘贴到coupon中。

将`product`的`application.yml`复制一份，粘贴到我们的coupon项目中，将数据源修改成coupon对应的库：`gulimall_sms`

```yaml
spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql://192.168.200.11:3306/gulimall_sms?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  global-config:
    db-config:
      id-type: auto
```

启动项目，访问`http://localhost:8080/coupon/smscoupon/list`测试一下

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210819115527.png)

成功

#### member

让member也依赖于common，修改pom.xml

```xml
<dependency>
    <groupId>wang.cai2.gulimall</groupId>
    <artifactId>gulimall-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

重新打开generator逆向工程，修改`generator.properties`

```properties
#代码生成器，配置信息
#主目录
mainPath=wang.cai2
#包名
package=wang.cai2.gulimall
moduleName=member
#作者
author=caicai
#Email
email=1732804469@qq.com
#表前缀(类名不会包含表前缀)
tablePrefix=ums_
```

> `application.yml`设置好要连接的数据源，启动逆向工程生成代码。将main粘贴到member中。

将`product`的`application.yml`复制一份，粘贴到我们的member项目中，将数据源修改成member对应的库：`gulimall_ums`

```yaml
spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql://192.168.200.11:3306/gulimall_ums?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  global-config:
    db-config:
      id-type: auto
```

启动项目，访问`http://localhost:8080/member/growthchangehistory/list`测试一下

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210819123757.png)

#### order

让order也依赖于common，修改pom.xml

```xml
<dependency>
    <groupId>wang.cai2.gulimall</groupId>
    <artifactId>gulimall-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

重新打开generator逆向工程，修改`generator.properties`

```properties
#代码生成器，配置信息
#主目录
mainPath=wang.cai2
#包名
package=wang.cai2.gulimall
moduleName=order
#作者
author=caicai
#Email
email=1732804469@qq.com
#表前缀(类名不会包含表前缀)
tablePrefix=oms_
```

> `application.yml`设置好要连接的数据源，启动逆向工程生成代码。将main粘贴到order中。

将`product`的`application.yml`复制一份，粘贴到我们的order项目中，将数据源修改成order对应的库：`gulimall_oms`

```yaml
spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql://192.168.200.11:3306/gulimall_oms?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  global-config:
    db-config:
      id-type: auto
```

启动项目，访问`http://localhost:8080/order/order/list`测试一下

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210819124600.png)

#### ware

让ware也依赖于common，修改pom.xml

```xml
<dependency>
    <groupId>wang.cai2.gulimall</groupId>
    <artifactId>gulimall-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

重新打开generator逆向工程，修改`generator.properties`

```properties
#代码生成器，配置信息
#主目录
mainPath=wang.cai2
#包名
package=wang.cai2.gulimall
moduleName=ware
#作者
author=caicai
#Email
email=1732804469@qq.com
#表前缀(类名不会包含表前缀)
tablePrefix=wms_
```

> `application.yml`设置好要连接的数据源，启动逆向工程生成代码。将main粘贴到ware中。

将`product`的`application.yml`复制一份，粘贴到我们的ware项目中，将数据源修改成ware对应的库：`gulimall_wms`

```yaml
spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql://192.168.200.11:3306/gulimall_wms?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  global-config:
    db-config:
      id-type: auto
```

启动项目，访问`http://localhost:8080/ware/wareinfo/list`测试一下

![](https://cdn.jsdelivr.net/gh/Cai2w/cdn/img/20210819162353.png)

### 配置端口号

```yaml
# coupon
server:
  port: 7001

# member
server:
  port: 8001

# order
server:
  port: 9001

# product
server:
  port: 10001

# ware
server:
  port: 11001
```

> 当我们配置完所有信息后，我们的项目都能够完美运行，但是很不幸，我的`renren-fast`运行报错了，原因是lombok罢工了，get/set方法不能生成了，修改下列包下面的类，手动给其中的类加上get/set方法即可运行。

```
io/renren/modules/app/form
io/renren/modules/job/entity
io/renren/modules/sys/entity
io/renren/modules/oss/cloud
io/renren/modules/oss/entity
io/renren/modules/sys/form
```